"use strict";(self.webpackChunkdocs_reanimated=self.webpackChunkdocs_reanimated||[]).push([[6382],{96067:(e,t,n)=>{n.d(t,{Z:()=>r});var a=n(67294);function l(e){let{value:t}=e;return a.createElement(a.Fragment,null,t?"\u2705":"\u274c")}function r(e){let{android:t=!1,ios:n=!1,web:r=!1}=e;return a.createElement("table",{className:"platform-compatibility"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Android"),a.createElement("th",null,"iOS"),a.createElement("th",null,"Web"))),a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,a.createElement(l,{value:t})),a.createElement("td",null,a.createElement(l,{value:n})),a.createElement("td",null,a.createElement(l,{value:r})))))}},31345:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>T,contentTitle:()=>x,default:()=>L,frontMatter:()=>S,metadata:()=>I,toc:()=>M});var a=n(87462),l=n(67294),r=n(3905),i=n(96067),o=n(67177),s=n(88548),u=n(24404),c=n(28033),m=n(71435),d=n(42233);function p(){const{colorScheme:e}=(0,m.tv)();return"light"===e?C.darkText:C.lightText}const h={code:"function MakeMutableTsx1(){const{checkListItemProps,runOnJS,onSubmit}=this.__closure;const selectedItems=checkListItemProps.filter(function(props){return props.selected.value;}).map(function(props){return props.item;});runOnJS(onSubmit)(selectedItems);}"};function k(e){let{items:t,onSubmit:n}=e;const r=(0,l.useMemo)((()=>t.map((e=>({item:e,selected:(0,d.makeMutable)(!1)})))),[t]),i=(0,l.useCallback)((()=>{(0,d.runOnUI)(function(){const e=function(){const e=r.filter((e=>e.selected.value)).map((e=>e.item));(0,d.runOnJS)(n)(e)};return e.__closure={checkListItemProps:r,runOnJS:d.runOnJS,onSubmit:n},e.__workletHash=0x9ed995eb629,e.__initData=h,e}())()}),[r,n]);return l.createElement(o.Z,{style:C.checkList},r.map((e=>l.createElement(v,(0,a.Z)({key:e.item},e)))),l.createElement(s.Z,{style:C.submitButton,onPress:i},l.createElement(u.Z,{style:C.submitButtonText},"Submit")))}const b={code:"function MakeMutableTsx2(){const{selected}=this.__closure;selected.value=!selected.value;}"};function v(e){let{item:t,selected:n}=e;const a=p(),r=(0,l.useCallback)((()=>{(0,d.runOnUI)(function(){const e=function(){n.value=!n.value};return e.__closure={selected:n},e.__workletHash=0xf9f4f050019,e.__initData=b,e}())()}),[n]);return l.createElement(s.Z,{style:C.listItem,onPress:r},l.createElement(y,{value:n}),l.createElement(u.Z,{style:[C.listItemText,a]},t))}const f={code:"function MakeMutableTsx3(){const{value}=this.__closure;return{opacity:value.value?1:0};}"};function y(e){let{value:t}=e;const n=(0,d.useAnimatedStyle)(function(){const e=()=>({opacity:t.value?1:0});return e.__closure={value:t},e.__workletHash=1927210694659,e.__initData=f,e}());return l.createElement(o.Z,{style:C.checkBox},l.createElement(d.default.View,{style:[C.checkBoxTick,n]}))}const g=["\ud83d\udc08 Cat","\ud83d\udc15 Dog","\ud83e\udd86 Duck","\ud83d\udc07 Rabbit","\ud83d\udc01 Mouse","\ud83d\udc13 Rooster"];function N(){const e=p(),[t,n]=(0,l.useState)([]);return l.createElement(o.Z,{style:C.container},l.createElement(k,{items:g,onSubmit:n}),l.createElement(u.Z,{style:e},"Selected items:"," ",t.length?t.join(", "):"None"))}const C=c.Z.create({container:{flex:1,alignItems:"center",justifyContent:"center"},checkList:{gap:8,padding:16},listItem:{flexDirection:"row",alignItems:"center",gap:12},listItemText:{fontSize:20},checkBox:{width:16,height:16,borderRadius:4,borderWidth:1,padding:2,borderColor:"var(--swm-purple-dark-100)"},checkBoxTick:{flex:1,borderRadius:2,backgroundColor:"var(--swm-purple-dark-100)"},submitButton:{backgroundColor:"var(--swm-purple-dark-100)",alignItems:"center",borderRadius:4,padding:8,marginTop:16},submitButtonText:{color:"var(--swm-off-white)",fontSize:16,fontWeight:"bold"},lightText:{color:"var(--swm-off-white)"},darkText:{color:"var(--swm-navy-light-100)"}}),w="import { Text, StyleSheet, View, TouchableOpacity } from 'react-native';\nimport { useColorScheme } from '@mui/material';\n\nimport React, { useCallback, useMemo, useState } from 'react';\nimport Animated, {\n  makeMutable,\n  runOnJS,\n  runOnUI,\n  useAnimatedStyle,\n} from 'react-native-reanimated';\nimport type { SharedValue } from 'react-native-reanimated';\n\nfunction useTextColorStyle() {\n  const { colorScheme } = useColorScheme();\n\n  return colorScheme === 'light' ? styles.darkText : styles.lightText;\n}\n\ntype CheckListSelectorProps = {\n  items: string[];\n  onSubmit: (selectedItems: string[]) => void;\n};\n\nfunction CheckListSelector({ items, onSubmit }: CheckListSelectorProps) {\n  const checkListItemProps = useMemo(\n    () =>\n      items.map((item) => ({\n        item,\n        // highlight-next-line\n        selected: makeMutable(false),\n      })),\n    [items]\n  );\n\n  const handleSubmit = useCallback(() => {\n    runOnUI(() => {\n      const selectedItems = checkListItemProps\n        .filter((props) => props.selected.value)\n        .map((props) => props.item);\n\n      runOnJS(onSubmit)(selectedItems);\n    })();\n  }, [checkListItemProps, onSubmit]);\n\n  return (\n    <View style={styles.checkList}>\n      {checkListItemProps.map((props) => (\n        <CheckListItem key={props.item} {...props} />\n      ))}\n      <TouchableOpacity style={styles.submitButton} onPress={handleSubmit}>\n        <Text style={styles.submitButtonText}>Submit</Text>\n      </TouchableOpacity>\n    </View>\n  );\n}\n\ntype CheckListItemProps = {\n  item: string;\n  selected: SharedValue<boolean>;\n};\n\nfunction CheckListItem({ item, selected }: CheckListItemProps) {\n  const textColor = useTextColorStyle();\n\n  const onPress = useCallback(() => {\n    // highlight-start\n    // No need to update the array of selected items, just toggle\n    // the selected value thanks to separate shared values\n    runOnUI(() => {\n      selected.value = !selected.value;\n    })();\n    // highlight-end\n  }, [selected]);\n\n  return (\n    <TouchableOpacity style={styles.listItem} onPress={onPress}>\n      {/* highlight-start */}\n      {/* No need to use `useDerivedValue` hook to get the `selected` value */}\n      <CheckBox value={selected} />\n      {/* highlight-end */}\n      <Text style={[styles.listItemText, textColor]}>{item}</Text>\n    </TouchableOpacity>\n  );\n}\n\ntype CheckBoxProps = {\n  value: SharedValue<boolean>;\n};\n\nfunction CheckBox({ value }: CheckBoxProps) {\n  const checkboxTickStyle = useAnimatedStyle(() => ({\n    opacity: value.value ? 1 : 0,\n  }));\n\n  return (\n    <View style={styles.checkBox}>\n      <Animated.View style={[styles.checkBoxTick, checkboxTickStyle]} />\n    </View>\n  );\n}\n\nconst ITEMS = [\n  '\ud83d\udc08 Cat',\n  '\ud83d\udc15 Dog',\n  '\ud83e\udd86 Duck',\n  '\ud83d\udc07 Rabbit',\n  '\ud83d\udc01 Mouse',\n  '\ud83d\udc13 Rooster',\n];\n\nexport default function App() {\n  const textColor = useTextColorStyle();\n  const [selectedItems, setSelectedItems] = useState<string[]>([]);\n\n  return (\n    <View style={styles.container}>\n      <CheckListSelector items={ITEMS} onSubmit={setSelectedItems} />\n      <Text style={textColor}>\n        Selected items:{' '}\n        {selectedItems.length ? selectedItems.join(', ') : 'None'}\n      </Text>\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n  },\n  checkList: {\n    gap: 8,\n    padding: 16,\n  },\n  listItem: {\n    flexDirection: 'row',\n    alignItems: 'center',\n    gap: 12,\n  },\n  listItemText: {\n    fontSize: 20,\n  },\n  checkBox: {\n    width: 16,\n    height: 16,\n    borderRadius: 4,\n    borderWidth: 1,\n    padding: 2,\n    borderColor: 'var(--swm-purple-dark-100)',\n  },\n  checkBoxTick: {\n    flex: 1,\n    borderRadius: 2,\n    backgroundColor: 'var(--swm-purple-dark-100)',\n  },\n  submitButton: {\n    backgroundColor: 'var(--swm-purple-dark-100)',\n    alignItems: 'center',\n    borderRadius: 4,\n    padding: 8,\n    marginTop: 16,\n  },\n  submitButtonText: {\n    color: 'var(--swm-off-white)',\n    fontSize: 16,\n    fontWeight: 'bold',\n  },\n  lightText: {\n    color: 'var(--swm-off-white)',\n  },\n  darkText: {\n    color: 'var(--swm-navy-light-100)',\n  },\n});\n",S={sidebar_position:9},x="makeMutable",I={unversionedId:"advanced/makeMutable",id:"advanced/makeMutable",title:"makeMutable",description:"The usage of makeMutable is discouraged in most cases. It's recommended to use the useSharedValue hook instead unless you know what you're doing and you are aware of the consequences (see the Remarks section).",source:"@site/docs/advanced/makeMutable.mdx",sourceDirName:"advanced",slug:"/advanced/makeMutable",permalink:"/react-native-reanimated/docs/advanced/makeMutable",draft:!1,editUrl:"https://github.com/software-mansion/react-native-reanimated/edit/main/packages/docs-reanimated/docs/advanced/makeMutable.mdx",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9},sidebar:"tutorialSidebar",previous:{title:"setNativeProps",permalink:"/react-native-reanimated/docs/advanced/setNativeProps"},next:{title:"Guides",permalink:"/react-native-reanimated/docs/category/guides"}},T={},M=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"<code>initial</code>",id:"initial",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Comparison with <code>useSharedValue</code>",id:"comparison-with-usesharedvalue",level:3},{value:"Platform compatibility",id:"platform-compatibility",level:2}],V=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},E=V("InteractiveExample"),_=V("Indent"),P={toc:M},R="wrapper";function L(e){let{components:t,...n}=e;return(0,r.kt)(R,(0,a.Z)({},P,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"makemutable"},"makeMutable"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The usage of ",(0,r.kt)("inlineCode",{parentName:"p"},"makeMutable")," is discouraged in most cases. It's recommended to use the ",(0,r.kt)("a",{parentName:"p",href:"/docs/core/useSharedValue"},(0,r.kt)("inlineCode",{parentName:"a"},"useSharedValue"))," hook instead unless you know what you're doing and you are aware of the consequences (see the ",(0,r.kt)("a",{parentName:"p",href:"#remarks"},"Remarks")," section)."),(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"makeMutable")," is used internally and its behavior may change over time.")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"makeMutable")," is a function internally used by the ",(0,r.kt)("a",{parentName:"p",href:"/docs/core/useSharedValue"},(0,r.kt)("inlineCode",{parentName:"a"},"useSharedValue"))," hook to create a ",(0,r.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#shared-value"},"shared value"),"."),(0,r.kt)("p",null,"It makes it possible to create mutable values without the use of the hook, which can be useful in some cases (e.g. in the global scope, as an array of mutable values, etc.)."),(0,r.kt)("p",null,"The created object is, in fact, the same as the one returned by ",(0,r.kt)("inlineCode",{parentName:"p"},"useSharedValue")," hook, so the further usage is the same."),(0,r.kt)("h2",{id:"reference"},"Reference"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { makeMutable } from 'react-native-reanimated';\n\nconst mv = makeMutable(100);\n")),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Type definitions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"interface SharedValue<Value = unknown> {\n  value: Value;\n  addListener: (listenerID: number, listener: (value: Value) => void) => void;\n  removeListener: (listenerID: number) => void;\n  modify: (\n    modifier?: <T extends Value>(value: T) => T,\n    forceUpdate?: boolean\n  ) => void;\n}\n\nfunction makeMutable<Value>(initial: Value): SharedValue<Value>;\n"))),(0,r.kt)("h3",{id:"arguments"},"Arguments"),(0,r.kt)("h4",{id:"initial"},(0,r.kt)("inlineCode",{parentName:"h4"},"initial")),(0,r.kt)("p",null,"The value you want to be initially stored to a ",(0,r.kt)("inlineCode",{parentName:"p"},".value")," property. It can be any JavaScript value like ",(0,r.kt)("inlineCode",{parentName:"p"},"number"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"string")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"boolean")," but also data structures such as ",(0,r.kt)("inlineCode",{parentName:"p"},"array")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"object"),"."),(0,r.kt)("h3",{id:"returns"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"makeMutable")," returns a mutable value with a single ",(0,r.kt)("inlineCode",{parentName:"p"},"value")," property initially set to the ",(0,r.kt)("inlineCode",{parentName:"p"},"initial"),"."),(0,r.kt)("p",null,"Data stored in mutable values can be accessed and modified by their ",(0,r.kt)("inlineCode",{parentName:"p"},".value")," property."),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)(E,{src:w,component:N,showCode:!0,mdxType:"InteractiveExample"}),(0,r.kt)("h2",{id:"remarks"},"Remarks"),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"We use ",(0,r.kt)("em",{parentName:"p"},"mutable value")," name for an object created by ",(0,r.kt)("inlineCode",{parentName:"p"},"makeMutable")," to distinguish it from the ",(0,r.kt)("em",{parentName:"p"},"shared value")," created by ",(0,r.kt)("inlineCode",{parentName:"p"},"useSharedValue"),". Technically, ",(0,r.kt)("em",{parentName:"p"},"shared value")," is a ",(0,r.kt)("em",{parentName:"p"},"mutable value")," with an automatic cleanup.")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"All remarks from the ",(0,r.kt)("a",{parentName:"p",href:"/docs/core/useSharedValue"},"useSharedValue")," hook apply to ",(0,r.kt)("inlineCode",{parentName:"p"},"makeMutable")," as well.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Don't call ",(0,r.kt)("inlineCode",{parentName:"p"},"makeMutable")," directly in the component scope. When component re-renders, it will create the completely new object (with the new ",(0,r.kt)("inlineCode",{parentName:"p"},"initial")," value if it was changed) and the state of the previous mutable value will be lost."))),(0,r.kt)(_,{mdxType:"Indent"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"function App() {\n  const [counter, setCounter] = useState(0);\n  const mv = makeMutable(counter); // \ud83d\udea8 creates a new mutable value on each render\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      setCounter((prev) => prev + 1); // updates the counter stored in the component state\n    }, 1000);\n\n    return () => {\n      clearInterval(interval);\n    };\n  }, [mv]);\n\n  useAnimatedReaction(\n    () => mv.value,\n    (value) => {\n      console.log(value); // prints 0, 1, 2, ...\n    }\n  );\n}\n"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Use ",(0,r.kt)("inlineCode",{parentName:"li"},"cancelAnimation")," to stop all animations running on the mutable value if it's no longer needed and there are still some animations running. Be super careful with infinite animations, as they will never stop unless you cancel them manually.")),(0,r.kt)(_,{mdxType:"Indent"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"function App() {\n  const mv = useMemo(() => makeMutable(0), []);\n\n  useEffect(() => {\n    mv.value = withRepeat(withSpring(100), -1, true); // creates an infinite animation\n\n    return () => {\n      cancelAnimation(mv); // \u2705 stops the infinite animation on component unmount\n    };\n  }, []);\n}\n"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You don't have to use ",(0,r.kt)("inlineCode",{parentName:"li"},"cancelAnimation")," when the value is not animated. It will be garbage collected automatically when no more references to it exist.")),(0,r.kt)(_,{mdxType:"Indent"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"const someFlag = makeMutable(false);\n\nfunction App() {\n  someFlag.value = true; // \u2705 no need to cancel the animation later on\n}\n"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When you decide to use ",(0,r.kt)("inlineCode",{parentName:"li"},"makeMutable"),", ensure that you follow ",(0,r.kt)("a",{parentName:"li",href:"https://react.dev/reference/rules"},"Rules of React")," and avoid common ",(0,r.kt)("inlineCode",{parentName:"li"},"useRef")," pitfalls, such as modifying the reference during rendering (see the ",(0,r.kt)("strong",{parentName:"li"},"Pitfall")," section in the ",(0,r.kt)("a",{parentName:"li",href:"https://react.dev/reference/react/useRef"},"useRef")," documentation for more details).")),(0,r.kt)("h3",{id:"comparison-with-usesharedvalue"},"Comparison with ",(0,r.kt)("inlineCode",{parentName:"h3"},"useSharedValue")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"th"},"makeMutable")),(0,r.kt)("th",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"th"},"useSharedValue")))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Creates a new object on each call"),(0,r.kt)("td",{parentName:"tr",align:null},"Reuses the same object on each call")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"If ",(0,r.kt)("inlineCode",{parentName:"td"},"initial")," value changes, a new object with the new value is created"),(0,r.kt)("td",{parentName:"tr",align:null},"If ",(0,r.kt)("inlineCode",{parentName:"td"},"initialValue")," value changes, the initially created object is returned without any changes")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Can be used outside of the component scope"),(0,r.kt)("td",{parentName:"tr",align:null},"Can be used only inside the component scope")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Can be used in loops (also when the number of iterations is not constant)"),(0,r.kt)("td",{parentName:"tr",align:null},"Can be used in loops only if the number of rendered hooks (",(0,r.kt)("inlineCode",{parentName:"td"},"useSharedValue")," calls) is constant")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"Doesn't automatically cancel animations when the component is unmounted"),(0,r.kt)("td",{parentName:"tr",align:null},"Automatically cancels animations when the component is unmounted")))),(0,r.kt)("h2",{id:"platform-compatibility"},"Platform compatibility"),(0,r.kt)(i.Z,{android:!0,ios:!0,web:!0,mdxType:"PlatformCompatibility"}))}L.isMDXComponent=!0}}]);