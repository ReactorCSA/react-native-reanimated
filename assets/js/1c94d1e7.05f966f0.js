"use strict";(self.webpackChunkdocs_reanimated=self.webpackChunkdocs_reanimated||[]).push([[5793],{96067:(e,n,t)=>{t.d(n,{Z:()=>r});var a=t(67294);function l(e){let{value:n}=e;return a.createElement(a.Fragment,null,n?"\u2705":"\u274c")}function r(e){let{android:n=!1,ios:t=!1,web:r=!1}=e;return a.createElement("table",{className:"platform-compatibility"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Android"),a.createElement("th",null,"iOS"),a.createElement("th",null,"Web"))),a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,a.createElement(l,{value:n})),a.createElement("td",null,a.createElement(l,{value:t})),a.createElement("td",null,a.createElement(l,{value:r})))))}},43198:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>j,contentTitle:()=>I,default:()=>M,frontMatter:()=>O,metadata:()=>Y,toc:()=>N});var a=t(87462),l=t(67294),r=t(3905),i=t(96067),o=t(67177),s=t(28033),c=t(42233);const u={code:"function FrameCallbackSimpleTsx1(frameInfo){const{t}=this.__closure;t.value=frameInfo.timeSinceFirstFrame/350;}"},m={code:"function FrameCallbackSimpleTsx2(){const{t,width}=this.__closure;const scale=2/(3-Math.cos(2*t.value));return{transform:[{translateX:scale*Math.cos(t.value)*Math.min(width/2-120,200)},{translateY:scale*(Math.sin(2*t.value)/2)*200}]};}"};function d(e){let{width:n}=e;const t=(0,c.useSharedValue)(0);(0,c.useFrameCallback)(function(){const e=function(e){t.value=e.timeSinceFirstFrame/350};return e.__closure={t:t},e.__workletHash=0x9b55df9bcbe,e.__initData=u,e}());const a=(0,c.useAnimatedStyle)(function(){const e=function(){const e=2/(3-Math.cos(2*t.value));return{transform:[{translateX:e*Math.cos(t.value)*Math.min(n/2-120,200)},{translateY:e*(Math.sin(2*t.value)/2)*200}]}};return e.__closure={t:t,width:n},e.__workletHash=7084236251646,e.__initData=m,e}());return l.createElement(o.Z,{style:h.container},l.createElement(c.default.View,{style:[h.dot,a]}))}const h=s.Z.create({container:{flex:1,alignItems:"center",justifyContent:"center",height:150},dot:{width:60,height:60,borderRadius:30,backgroundColor:"#b58df1",position:"absolute"}}),b="import React from 'react';\nimport { StyleSheet, View } from 'react-native';\nimport Animated, {\n  useFrameCallback,\n  useSharedValue,\n  useAnimatedStyle,\n} from 'react-native-reanimated';\n\ninterface AppProps {\n  width: number;\n}\n\nexport default function App({ width }: AppProps) {\n  const t = useSharedValue<number>(0);\n\n  // highlight-start\n  useFrameCallback((frameInfo) => {\n    t.value = frameInfo.timeSinceFirstFrame / 350;\n  });\n  // highlight-end\n\n  const infinityStyle = useAnimatedStyle(() => {\n    const scale = 2 / (3 - Math.cos(2 * t.value));\n    return {\n      transform: [\n        {\n          translateX:\n            scale * Math.cos(t.value) * Math.min(width / 2 - 120, 200),\n        },\n        { translateY: scale * (Math.sin(2 * t.value) / 2) * 200 },\n      ],\n    };\n  });\n\n  return (\n    <View style={styles.container}>\n      <Animated.View style={[styles.dot, infinityStyle]} />\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: 150,\n  },\n  dot: {\n    width: 60,\n    height: 60,\n    borderRadius: 30,\n    backgroundColor: '#b58df1',\n    position: 'absolute',\n  },\n});\n";var v=t(70399),f=t(24404);const p=.6,k=5e-5,y=40,g=1e3,E={height:85,width:82,x:0,y:y},_={height:85,width:82,x:0,y:y},C={code:"function FrameCallbackDinoTsx1(frameInfo){const{DEFAULT_HORSE,horseY,DEFAULT_OBSTACLE,obstacleX,isColliding,gameOver,vx,width,VELOCITY_INCREMENT}=this.__closure;const{timeSincePreviousFrame:dt}=frameInfo;if(dt==null){return;}const horse={...DEFAULT_HORSE,y:horseY.value};const obstacle={...DEFAULT_OBSTACLE,x:obstacleX.value};if(isColliding(horse,obstacle)||gameOver.value){gameOver.value=true;return;}obstacleX.value=obstacleX.value>-100?obstacleX.value-vx.value*dt:width.value;vx.value+=VELOCITY_INCREMENT;}"},T={code:"function FrameCallbackDinoTsx2(){const{obstacleX,DEFAULT_OBSTACLE}=this.__closure;return{transform:[{translateX:obstacleX.value},{translateY:DEFAULT_OBSTACLE.y}]};}"},F={code:"function FrameCallbackDinoTsx3(){const{DEFAULT_HORSE,horseY}=this.__closure;return{transform:[{translateX:DEFAULT_HORSE.x},{translateY:horseY.value},{rotateY:'180deg'}]};}"},S={code:"function FrameCallbackDinoTsx4(){const{gameOver}=this.__closure;return{transform:[{translateY:gameOver.value===true?0:-1000}]};}"};function x(){const e=(0,c.useSharedValue)(p),n=(0,c.useSharedValue)(0),t=(0,c.useSharedValue)(g),a=(0,c.useSharedValue)(y),r=(0,c.useSharedValue)(!1);(0,c.useFrameCallback)(function(){const l=function(l){const{timeSincePreviousFrame:i}=l;if(null==i)return;const o={..._,y:a.value},s={...E,x:t.value};L(o,s)||r.value?r.value=!0:(t.value=t.value>-100?t.value-e.value*i:n.value,e.value+=k)};return l.__closure={DEFAULT_HORSE:_,horseY:a,DEFAULT_OBSTACLE:E,obstacleX:t,isColliding:L,gameOver:r,vx:e,width:n,VELOCITY_INCREMENT:k},l.__workletHash=3185936793975,l.__initData=C,l}());const i=(0,c.useAnimatedStyle)(function(){const e=()=>({transform:[{translateX:t.value},{translateY:E.y}]});return e.__closure={obstacleX:t,DEFAULT_OBSTACLE:E},e.__workletHash=598128048319,e.__initData=T,e}()),s=(0,c.useAnimatedStyle)(function(){const e=()=>({transform:[{translateX:_.x},{translateY:a.value},{rotateY:"180deg"}]});return e.__closure={DEFAULT_HORSE:_,horseY:a},e.__workletHash=7481394469968,e.__initData=F,e}()),u=(0,c.useAnimatedStyle)(function(){const e=()=>({transform:[{translateY:!0===r.value?0:-1e3}]});return e.__closure={gameOver:r},e.__workletHash=0xf0c9f5032be,e.__initData=S,e}()),m=()=>{a.value===y&&(a.value=(0,c.withSequence)((0,c.withTiming)(y-120,{easing:c.Easing.bezier(.3,.11,.15,.97)}),(0,c.withTiming)(y,{easing:c.Easing.poly(4)})))},d=()=>{r.value=!1,t.value=g,a.value=y,e.value=p};return l.createElement(l.Fragment,null,l.createElement(v.Z,{style:A.container,onLayout:e=>{n.value=e.nativeEvent.layout.width},onPressIn:()=>{r.value?d():m()}},l.createElement(c.default.View,{style:[A.overlay,u]},l.createElement(f.Z,{style:A.text},"Game Over")),l.createElement(c.default.Text,{style:[A.obstacle,i]},"\ud83c\udf35"),l.createElement(c.default.Text,{style:[A.horse,s]},"\ud83d\udc0e"),l.createElement(o.Z,{style:A.ground})))}const A=s.Z.create({container:{flex:1,height:200},horse:{position:"absolute",fontSize:80},ground:{position:"absolute",right:0,bottom:70,width:"100%",height:2,backgroundColor:"#000"},obstacle:{position:"absolute",fontSize:80},text:{fontSize:40,color:"white",backgroundColor:"rgba(0,0,0,0.5)",paddingHorizontal:8},overlay:{justifyContent:"center",alignItems:"center",position:"absolute",width:"100%",zIndex:1}}),w={code:"function isColliding_FrameCallbackDinoTsx5(obj1,obj2){return obj1.x<obj2.x+obj2.width&&obj1.x+obj1.width>obj2.x&&obj1.y<obj2.y+obj2.height&&obj1.y+obj1.height>obj2.y;}"},L=function(){const e=function(e,n){return e.x<n.x+n.width&&e.x+e.width>n.x&&e.y<n.y+n.height&&e.y+e.height>n.y};return e.__closure={},e.__workletHash=9316259044170,e.__initData=w,e}(),D="import Animated, {\n  useSharedValue,\n  useFrameCallback,\n  useAnimatedStyle,\n  withSequence,\n  withTiming,\n  Easing,\n  FrameInfo,\n} from 'react-native-reanimated';\nimport {\n  View,\n  StyleSheet,\n  Pressable,\n  Text,\n  LayoutChangeEvent,\n} from 'react-native';\nimport React from 'react';\n\ninterface CollisionObject {\n  height: number;\n  width: number;\n  x: number;\n  y: number;\n}\n\nconst HEIGHT = 200;\nconst DEFAULT_VELOCITY = 0.6;\nconst VELOCITY_INCREMENT = 0.00005;\nconst GROUND_LEVEL = 80;\nconst DEFAULT_Y = HEIGHT - GROUND_LEVEL - 80;\nconst DEFAULT_X = 1000;\n\nconst DEFAULT_OBSTACLE = {\n  height: 85,\n  width: 82,\n  x: 0,\n  y: DEFAULT_Y,\n};\nconst DEFAULT_HORSE = {\n  height: 85,\n  width: 82,\n  x: 0,\n  y: DEFAULT_Y,\n};\n\nexport default function FrameCallbackDino() {\n  const vx = useSharedValue<number>(DEFAULT_VELOCITY);\n  const width = useSharedValue<number>(0);\n\n  const obstacleX = useSharedValue<number>(DEFAULT_X);\n  const horseY = useSharedValue<number>(DEFAULT_Y);\n\n  const gameOver = useSharedValue<boolean>(false);\n\n  const getDimensions = (event: LayoutChangeEvent) => {\n    width.value = event.nativeEvent.layout.width;\n  };\n\n  // highlight-next-line\n  useFrameCallback((frameInfo: FrameInfo) => {\n    const { timeSincePreviousFrame: dt } = frameInfo;\n    if (dt == null) {\n      return;\n    }\n\n    const horse: CollisionObject = { ...DEFAULT_HORSE, y: horseY.value };\n    const obstacle: CollisionObject = {\n      ...DEFAULT_OBSTACLE,\n      x: obstacleX.value,\n    };\n\n    if (isColliding(horse, obstacle) || gameOver.value) {\n      gameOver.value = true;\n      return;\n    }\n\n    obstacleX.value =\n      obstacleX.value > -100 ? obstacleX.value - vx.value * dt : width.value;\n\n    vx.value += VELOCITY_INCREMENT;\n    // highlight-next-line\n  });\n\n  const obstacleStyles = useAnimatedStyle(() => ({\n    transform: [\n      { translateX: obstacleX.value },\n      { translateY: DEFAULT_OBSTACLE.y },\n    ],\n  }));\n\n  const horseStyles = useAnimatedStyle(() => ({\n    transform: [\n      { translateX: DEFAULT_HORSE.x },\n      { translateY: horseY.value },\n      { rotateY: '180deg' },\n    ],\n  }));\n\n  const overlayStyles = useAnimatedStyle(() => ({\n    transform: [{ translateY: gameOver.value === true ? 0 : -1000 }],\n  }));\n\n  const handleTap = () => {\n    if (gameOver.value) {\n      handleRestart();\n    } else {\n      handleJump();\n    }\n  };\n\n  const handleJump = () => {\n    if (horseY.value === DEFAULT_Y) {\n      horseY.value = withSequence(\n        withTiming(DEFAULT_Y - 120, {\n          easing: Easing.bezier(0.3, 0.11, 0.15, 0.97),\n        }),\n        withTiming(DEFAULT_Y, { easing: Easing.poly(4) })\n      );\n    }\n  };\n\n  const handleRestart = () => {\n    gameOver.value = false;\n    obstacleX.value = DEFAULT_X;\n    horseY.value = DEFAULT_Y;\n    vx.value = DEFAULT_VELOCITY;\n  };\n\n  return (\n    <>\n      <Pressable\n        style={styles.container}\n        onLayout={getDimensions}\n        onPressIn={handleTap}>\n        <Animated.View style={[styles.overlay, overlayStyles]}>\n          <Text style={styles.text}>Game Over</Text>\n        </Animated.View>\n        <Animated.Text style={[styles.obstacle, obstacleStyles]}>\n          \ud83c\udf35\n        </Animated.Text>\n        <Animated.Text style={[styles.horse, horseStyles]}>\ud83d\udc0e</Animated.Text>\n        <View style={styles.ground} />\n      </Pressable>\n    </>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    height: 200,\n  },\n  horse: {\n    position: 'absolute',\n    fontSize: 80,\n  },\n  ground: {\n    position: 'absolute',\n    right: 0,\n    bottom: GROUND_LEVEL - 10,\n    width: '100%',\n    height: 2,\n    backgroundColor: '#000',\n  },\n  obstacle: {\n    position: 'absolute',\n    fontSize: 80,\n  },\n  text: {\n    fontSize: 40,\n    color: 'white',\n    backgroundColor: 'rgba(0,0,0,0.5)',\n    paddingHorizontal: 8,\n  },\n  overlay: {\n    justifyContent: 'center',\n    alignItems: 'center',\n    position: 'absolute',\n    width: '100%',\n    zIndex: 1,\n  },\n});\n\nfunction isColliding(obj1: CollisionObject, obj2: CollisionObject) {\n  'worklet';\n  return (\n    obj1.x < obj2.x + obj2.width &&\n    obj1.x + obj1.width > obj2.x &&\n    obj1.y < obj2.y + obj2.height &&\n    obj1.y + obj1.height > obj2.y\n  );\n}\n",O={sidebar_position:3},I="useFrameCallback",Y={unversionedId:"advanced/useFrameCallback",id:"advanced/useFrameCallback",title:"useFrameCallback",description:"useFrameCallback lets you run a function on every frame update.",source:"@site/docs/advanced/useFrameCallback.mdx",sourceDirName:"advanced",slug:"/advanced/useFrameCallback",permalink:"/react-native-reanimated/docs/advanced/useFrameCallback",draft:!1,editUrl:"https://github.com/software-mansion/react-native-reanimated/edit/main/packages/docs-reanimated/docs/advanced/useFrameCallback.mdx",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"useAnimatedReaction",permalink:"/react-native-reanimated/docs/advanced/useAnimatedReaction"},next:{title:"useEvent",permalink:"/react-native-reanimated/docs/advanced/useEvent"}},j={},N=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"<code>callback</code>",id:"callback",level:4},{value:"<code>autostart</code> <Optional />",id:"autostart-",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}],U=e=>function(n){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",n)},V=U("InteractiveExample"),R=U("Optional"),X={toc:N},H="wrapper";function M(e){let{components:n,...t}=e;return(0,r.kt)(H,(0,a.Z)({},X,t,{components:n,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"useframecallback"},"useFrameCallback"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"useFrameCallback")," lets you run a function on every frame update."),(0,r.kt)(V,{src:b,component:d,mdxType:"InteractiveExample"}),(0,r.kt)("h2",{id:"reference"},"Reference"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"import { useFrameCallback } from 'react-native-reanimated';\n\nfunction App() {\n  const frameCallback = useFrameCallback((frameInfo) => {\n    // Increment a value on every frame update\n    sv.value += 1;\n  });\n\n  return (\n    <Button\n      title=\"Start/Stop\"\n      onPress={() => frameCallback.setActive(!frameCallback.isActive)}\n    />\n  );\n}\n")),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Type definitions"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-typescript"},"type FrameInfo = {\n  timestamp: number;\n  timeSincePreviousFrame: number | null;\n  timeSinceFirstFrame: number;\n};\n\ntype FrameCallback = {\n  setActive: (isActive: boolean) => void;\n  isActive: boolean;\n  callbackId: number;\n};\n\nfunction useFrameCallback(\n  callback: (frameInfo: FrameInfo) => void,\n  autostart = true\n): FrameCallback;\n"))),(0,r.kt)("h3",{id:"arguments"},"Arguments"),(0,r.kt)("h4",{id:"callback"},(0,r.kt)("inlineCode",{parentName:"h4"},"callback")),(0,r.kt)("p",null,"A function executed on every frame update. This function receives a ",(0,r.kt)("inlineCode",{parentName:"p"},"frameInfo")," object containing the following fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timestamp")," a number indicating the system time (in milliseconds) when the last frame was rendered."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timeSincePreviousFrame")," a number indicating the time (in milliseconds) since last frame. This value will be null on the first frame after activation. Starting from the second frame, it should be ~16 ms on 60 Hz, and ~8 ms on 120 Hz displays (provided there are no frame dropped)."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"timeSinceFirstFrame")," a number indicating the time (in milliseconds) since the callback was activated.")),(0,r.kt)("h4",{id:"autostart-"},(0,r.kt)("inlineCode",{parentName:"h4"},"autostart")," ",(0,r.kt)(R,{mdxType:"Optional"})),(0,r.kt)("p",null,"Whether the callback should start automatically. Defaults to ",(0,r.kt)("inlineCode",{parentName:"p"},"true"),"."),(0,r.kt)("h3",{id:"returns"},"Returns"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"useFrameCallback")," returns an object containing these fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"setActive")," a function that lets you start the frame callback or stop it from running"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"isActive")," a boolean indicating whether a callback is running"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"callbackId")," a number indicating a unique identifier of the frame callback")),(0,r.kt)("h2",{id:"example"},"Example"),(0,r.kt)(V,{src:D,component:x,label:"Tap to jump",mdxType:"InteractiveExample"}),(0,r.kt)("h2",{id:"remarks"},"Remarks"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"A function passed to the ",(0,r.kt)("inlineCode",{parentName:"li"},"callback")," argument is automatically ",(0,r.kt)("a",{parentName:"li",href:"/docs/fundamentals/glossary#to-workletize"},"workletized")," and ran on the ",(0,r.kt)("a",{parentName:"li",href:"/docs/fundamentals/glossary#ui-thread"},"UI thread"),".")),(0,r.kt)("h2",{id:"platform-compatibility"},"Platform compatibility"),(0,r.kt)(i.Z,{android:!0,ios:!0,web:!0,mdxType:"PlatformCompatibility"}))}M.isMDXComponent=!0}}]);