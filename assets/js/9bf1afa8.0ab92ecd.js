"use strict";(self.webpackChunkdocs_reanimated=self.webpackChunkdocs_reanimated||[]).push([[5808],{96067:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(67294);function r(e){let{value:t}=e;return a.createElement(a.Fragment,null,t?"\u2705":"\u274c")}function i(e){let{android:t=!1,ios:n=!1,web:i=!1}=e;return a.createElement("table",{className:"platform-compatibility"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("th",null,"Android"),a.createElement("th",null,"iOS"),a.createElement("th",null,"Web"))),a.createElement("tbody",null,a.createElement("tr",null,a.createElement("td",null,a.createElement(r,{value:t})),a.createElement("td",null,a.createElement(r,{value:n})),a.createElement("td",null,a.createElement(r,{value:i})))))}},3761:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>v,contentTitle:()=>b,default:()=>C,frontMatter:()=>g,metadata:()=>y,toc:()=>S});var a=n(87462),r=n(67294),i=n(3905),l=n(96067),o=n(67177),s=n(72400),u=n(24404),d=n(28033),c=n(42233);const m={code:"function RunOnJSTsx1(){const{runOnJS,setFinished}=this.__closure;runOnJS(setFinished)(true);}"},p={code:"function RunOnJSTsx2(){const{scale}=this.__closure;return{transform:[{scale:scale.value}]};}"};function h(){const e=(0,c.useSharedValue)(1),[t,n]=r.useState(!1),a=(0,c.useAnimatedStyle)(function(){const t=()=>({transform:[{scale:e.value}]});return t.__closure={scale:e},t.__workletHash=8738913883780,t.__initData=p,t}());return r.createElement(o.Z,{style:f.container},r.createElement(c.default.View,{style:[f.box,a]}),r.createElement(s.Z,{onPress:()=>{e.value=(0,c.withSpring)(2,{},function(){const e=function(){(0,c.runOnJS)(n)(!0)};return e.__closure={runOnJS:c.runOnJS,setFinished:n},e.__workletHash=7767882256352,e.__initData=m,e}())},title:"Click me",disabled:t}),t&&r.createElement(u.Z,null,"Finished! \ud83c\udf89"))}const f=d.Z.create({container:{flex:1,alignItems:"center"},box:{height:100,width:100,backgroundColor:"#b58df1",borderRadius:20,marginVertical:64,alignSelf:"center"}}),k="import React from 'react';\nimport { Button, View, StyleSheet, Text } from 'react-native';\nimport Animated, {\n  useSharedValue,\n  withSpring,\n  runOnJS,\n} from 'react-native-reanimated';\nimport { useAnimatedStyle } from 'react-native-reanimated';\n\nexport default function App() {\n  const scale = useSharedValue<number>(1);\n  const [finished, setFinished] = React.useState<boolean>(false);\n\n  const handlePress = () => {\n    scale.value = withSpring(2, {}, () => {\n      // highlight-next-line\n      runOnJS(setFinished)(true);\n    });\n  };\n\n  const animatedStyle = useAnimatedStyle(() => ({\n    transform: [{ scale: scale.value }],\n  }));\n\n  return (\n    <View style={styles.container}>\n      <Animated.View style={[styles.box, animatedStyle]} />\n      <Button onPress={handlePress} title=\"Click me\" disabled={finished} />\n      {finished && <Text>Finished! \ud83c\udf89</Text>}\n    </View>\n  );\n}\n\nconst styles = StyleSheet.create({\n  container: {\n    flex: 1,\n    alignItems: 'center',\n  },\n  box: {\n    height: 100,\n    width: 100,\n    backgroundColor: '#b58df1',\n    borderRadius: 20,\n    marginVertical: 64,\n    alignSelf: 'center',\n  },\n});\n",g={sidebar_position:1},b="runOnJS",y={unversionedId:"threading/runOnJS",id:"threading/runOnJS",title:"runOnJS",description:"runOnJS lets you asynchronously run non-workletized functions that couldn't otherwise run on the UI thread. This applies to most external libraries as they don't have their functions marked with \"worklet\"; directive.",source:"@site/docs/threading/runOnJS.mdx",sourceDirName:"threading",slug:"/threading/runOnJS",permalink:"/react-native-reanimated/docs/threading/runOnJS",draft:!1,editUrl:"https://github.com/software-mansion/react-native-reanimated/edit/main/packages/docs-reanimated/docs/threading/runOnJS.mdx",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Threading",permalink:"/react-native-reanimated/docs/category/threading"},next:{title:"runOnUI",permalink:"/react-native-reanimated/docs/threading/runOnUI"}},v={},S=[{value:"Reference",id:"reference",level:2},{value:"Arguments",id:"arguments",level:3},{value:"fn",id:"fn",level:4},{value:"Returns",id:"returns",level:3},{value:"Example",id:"example",level:2},{value:"Remarks",id:"remarks",level:2},{value:"Platform compatibility",id:"platform-compatibility",level:2}],x=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},w=x("InteractiveExample"),J=x("Indent"),O={toc:S},N="wrapper";function C(e){let{components:t,...n}=e;return(0,i.kt)(N,(0,a.Z)({},O,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"runonjs"},"runOnJS"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"runOnJS")," lets you asynchronously run non-",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#to-workletize"},"workletized")," functions that couldn't otherwise run on the ",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#ui-thread"},"UI thread"),". This applies to most external libraries as they don't have their functions marked with ",(0,i.kt)("inlineCode",{parentName:"p"},'"worklet";')," directive."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"runOnJS")," is usually used to update React state either on animation finish or conditionally within a gesture."),(0,i.kt)("h2",{id:"reference"},"Reference"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"import { runOnJS } from 'react-native-reanimated';\n\nfunction App() {\n  // While on the UI thread\n  runOnJS(navigation.goBack)();\n}\n")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Type definitions"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-typescript"},"function runOnJS<A extends any[], R>(\n  fn: (...args: A) => R\n): (...args: Parameters<typeof fn>) => void;\n"))),(0,i.kt)("h3",{id:"arguments"},"Arguments"),(0,i.kt)("h4",{id:"fn"},"fn"),(0,i.kt)("p",null,"A reference to a function you want to execute on the ",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#javascript-thread"},"JavaScript thread")," from the ",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#ui-thread"},"UI thread"),". Arguments to your function have to be passed to the function returned from ",(0,i.kt)("inlineCode",{parentName:"p"},"runOnJS")," i.e. ",(0,i.kt)("inlineCode",{parentName:"p"},"runOnJS(setValue)(10);"),"."),(0,i.kt)("h3",{id:"returns"},"Returns"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"runOnJS")," returns a function that accepts arguments for the function passed as the first argument. This function can be safely executed on the UI thread."),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Don't forget to call the function returned from ",(0,i.kt)("inlineCode",{parentName:"p"},"runOnJS"),".")),(0,i.kt)("h2",{id:"example"},"Example"),(0,i.kt)(w,{src:k,component:h,mdxType:"InteractiveExample"}),(0,i.kt)("h2",{id:"remarks"},"Remarks"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Functions passed to ",(0,i.kt)("inlineCode",{parentName:"li"},"runOnJS")," must be defined in the ",(0,i.kt)("a",{parentName:"li",href:"/docs/fundamentals/glossary#javascript-thread"},"JavaScript thread")," scope, i.e. in the component body or the global scope. This code won't work because ",(0,i.kt)("inlineCode",{parentName:"li"},"myFunction")," is defined in the ",(0,i.kt)("inlineCode",{parentName:"li"},"withTiming")," callback, which is only executed in the ",(0,i.kt)("a",{parentName:"li",href:"/docs/fundamentals/glossary#ui-thread"},"UI thread"),":")),(0,i.kt)(J,{mdxType:"Indent"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"withTiming(0, {}, () => {\n  // myFunction is defined on the UI thread \ud83d\udea8\n  const myFunction = () => {\n    // ...\n  };\n  runOnJS(myFunction)(); // \ud83d\udca5\n});\n"))),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"It's a common mistake to execute function inside of runOnJS like this: ",(0,i.kt)("del",{parentName:"p"},(0,i.kt)("inlineCode",{parentName:"del"},"runOnJS(setValue(10))()")),". Here, the correct usage would be ",(0,i.kt)("inlineCode",{parentName:"p"},"runOnJS(setValue)(10)"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"It's safe to run functions via ",(0,i.kt)("inlineCode",{parentName:"p"},"runOnJS")," on the ",(0,i.kt)("a",{parentName:"p",href:"/docs/fundamentals/glossary#javascript-thread"},"JavaScript thread"),", as this has no effect."))),(0,i.kt)("h2",{id:"platform-compatibility"},"Platform compatibility"),(0,i.kt)(l.Z,{android:!0,ios:!0,web:!0,mdxType:"PlatformCompatibility"}))}C.isMDXComponent=!0},72400:(e,t,n)=>{n.d(t,{Z:()=>u});var a=n(67294),r=n(28033),i=n(88548),l=n(24404),o=a.forwardRef(((e,t)=>{var n=e.accessibilityLabel,r=e.color,o=e.disabled,u=e.onPress,d=e.testID,c=e.title;return a.createElement(i.Z,{accessibilityLabel:n,accessibilityRole:"button",disabled:o,focusable:!o,onPress:u,ref:t,style:[s.button,r&&{backgroundColor:r},o&&s.buttonDisabled],testID:d},a.createElement(l.Z,{style:[s.text,o&&s.textDisabled]},c))}));o.displayName="Button";var s=r.Z.create({button:{backgroundColor:"#2196F3",borderRadius:2},text:{color:"#fff",fontWeight:"500",padding:8,textAlign:"center",textTransform:"uppercase"},buttonDisabled:{backgroundColor:"#dfdfdf"},textDisabled:{color:"#a1a1a1"}});const u=o}}]);